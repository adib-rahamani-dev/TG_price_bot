# ุฎูุงุตู ุชุบุฑุงุช ุงุตูุงุญโุดุฏู

## ูุดฺฉูุงุช ุซุงุจุชโุดุฏู:

### 1. โ ููุงุฏ USD ุงุดุชุจุงู
**ูุดฺฉู:** ููุงุฏ "USD" ุฏุฑ ููุชุฑ ูุฌูุฏ ุฏุงุดุช ุงูุง API ุงุฒ ุขู ูพุดุชุจุงู ููโฺฉูุฏ
**ุญู:** ุชุบุฑ ุจู "USDT" ฺฉู ููุงุฏ ุฏุฑุณุช ุงุณุช

```python
# ูุจู:
FILTER_SYMBOLS = ["USD", "IR_GOLD_18K", "IR_COIN_EMAMI"]

# ุจุนุฏ:
FILTER_SYMBOLS = ["USDT", "IR_GOLD_18K", "IR_COIN_EMAMI"]
```

### 2. โ ุฐุฎุฑู ุฏุฑ market_cache.json
**ูุดฺฉู:** API response ููุท ุฏุฑ prices_cache.json ุฐุฎุฑู ูโุดุฏ
**ุญู:** ุงูุฒูุฏู ุฐุฎุฑู ุฎูุฏฺฉุงุฑ ุฏุฑ market_cache.json

```python
# ุฏุฑ fetch_data():
- Save full API response to market_cache.json
- with open(MARKET_CACHE_FILE, 'w', encoding='utf-8') as mf:
    json.dump(data, mf, ensure_ascii=False, indent=2)
```

### 3. โ ุงุถุงูู ฺฉุฑุฏู ููุฏ unit (ูุงุญุฏ ูพูู)
**ูุดฺฉู:** ููุงุด ููุชโูุง ุจุฏูู ููุงุด ูุงุญุฏ ูพูู (ุชููุงู/ุฏูุงุฑ)
**ุญู:** ุงุถุงูู ฺฉุฑุฏู ููุฏ "unit" ุจู ุชูุงู data structures

```python
# ุฏุฑ build_message():
unit = item.get("unit", "ุชููุงู")
msg += f"<b>{item['name']}:</b> {item['price']} {unit} ({arrow} {item['change_percent']}%)\n"
```

### 4. โ ุจูุจูุฏ fallback caching
**ูุดฺฉู:** ุชุฑุชุจ ุงูููุช ฺฉุด ุตุญุญ ูุจูุฏ
**ุญู:** ุชุฑุชุจ ุฏุฑุณุช:
1. prices_history.json (ุขุฎุฑู ุฏุงุฏู ุฐุฎุฑูโุดุฏู)
2. market_cache.json (ฺฉุด API ฺฉุงูู)
3. prices_cache.json (ุจุฑุง ุณุงุฒฺฏุงุฑ ูุนฺฉูุณ)

---

## ุชุบุฑุงุช ฺฉุฏ:

### ูุงู: `price_test.py`

#### 1. ุชุนุฑู ููุงุฏูุง (ุฎุทูุท 33-34):
```python
FILTER_SYMBOLS = ["USDT", "IR_GOLD_18K", "IR_COIN_EMAMI"]
MARKET_CACHE_FILE = "market_cache.json"
```

#### 2. ุชุงุจุน fetch_data() - ุจูุจูุฏ ุฐุฎุฑูโุณุงุฒ:
- ุงุถุงูู ฺฉุฑุฏู ููุฏ `unit` ุจู filtered items
- ุฐุฎุฑู ุจู market_cache.json
- ุจูุจูุฏ ุชุงุจุน fallback ุจุฑุง ุฎูุงูุฏู ุงุฒ ฺฉุดโูุง ูุฎุชูู

#### 3. ุชุงุจุน build_message():
```python
unit = item.get("unit", "ุชููุงู")
msg += f"<b>{item['name']}:</b> {item['price']} {unit} ({arrow} {item['change_percent']}%)\n"
```

#### 4. Button handler (get_price):
- ุจุฑุฑุณ market_cache.json ูุจู ุงุฒ prices_cache.json
- ุงุถุงูู ฺฉุฑุฏู ููุฏ unit

#### 5. Dashboard endpoint:
- ุงุถุงูู ฺฉุฑุฏู ููุฏ 'unit' ุจู prices

---

## ูุงูโูุง ุงุณุชูุงุฏูโุดุฏู:

| ูุงู | ุชูุถุญ |
|------|---------|
| `prices_history.json` | ุชุงุฑุฎ ุชูุงู ููุชโูุง ุฏุฑุงูุชโุดุฏู (ุญุฏุงฺฉุซุฑ 48 ูุฑูุฏ) |
| `market_cache.json` | ฺฉุด ฺฉุงูู API (ุจุฑุง ุฏุณุชุฑุณ ุณุฑุน) |
| `prices_cache.json` | ููุชโูุง ููุชุฑโุดุฏู (ุณุงุฒฺฏุงุฑ ูุนฺฉูุณ) |

---

## ููุงุฏโูุง ููุชุฑโุดุฏู:

โ **USDT** - ุฑุงู/ุฏูุงุฑ (ููุงุฏ ุฏุฑุณุช)
โ **IR_GOLD_18K** - ุทูุง 18 ุนุงุฑ
โ **IR_COIN_EMAMI** - ุณฺฉู ุงูุงู

---

## ููููู Output:

```
๐ฐ ุขุฎุฑู ููุชโูุง
โฐ 2026/02/04 14:14

ุทูุง 18 ุนุงุฑ: 19483900 ุชููุงู (๐ป -0.47%)
ุณฺฉู ุงูุงู: 2150000 ุชููุงู (๐บ 0.23%)
USDT: 42500 ุชููุงู (๐ป -0.15%)
```

---

## ฺฉ ุงุณุชูุงุฏู ฺฉูุฏ:

โ ูุฑ ุจุงุฑ ฺฉู ููุชโูุง ุจูโุฑูุฒ ูโุดููุฏ:
- ููุชโูุง ุฎูุฏฺฉุงุฑ ุฏุฑ prices_history.json ุฐุฎุฑู ูโุดููุฏ
- ฺฉุด ฺฉุงูู API ุฏุฑ market_cache.json ุฐุฎุฑู ูโุดูุฏ
- ููุชุฑโุดุฏูโูุง ุฏุฑ prices_cache.json ุฐุฎุฑู ูโุดููุฏ

โ ุฏุฑ ุตูุฑุช ูุทุน ุงูุชุฑูุช:
- ุณุณุชู ุฎูุฏฺฉุงุฑ ุงุฒ market_cache.json ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุงฺฏุฑ market_cache.json ููุฌูุฏ ูุจูุฏุ ุงุฒ prices_history.json ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุงฺฏุฑ ูุฑ ุฏู ููุฌูุฏ ูุจูุฏูุฏุ ุงุฒ prices_cache.json ุงุณุชูุงุฏู ูโฺฉูุฏ
